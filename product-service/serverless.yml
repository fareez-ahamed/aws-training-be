service: aws-training-product-service # NOTE: update this with your service name
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  memorySize: 128
  httpApi:
    cors: true
    # payload: "2.0"
    # disableDefaultEndpoint: false
  environment:
    PRODUCT_TABLE_NAME: aws_training_products
    STOCK_TABLE_NAME: aws_training_stock
  iamRoleStatements:
    - Effect: Allow
      Action: 
        - dynamoDb:Query
        - dynamoDb:Scan
        - dynamoDb:GetItem
        - dynamoDb:PutItem
        - dynamoDb:UpdateItem
        - dynamoDb:DeleteItem
        - dynamodb:BatchWriteItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:396572677717:table/aws_training_products"
        - "arn:aws:dynamodb:us-east-1:396572677717:table/aws_training_stock"

functions:

  get_products:
    handler: handlers/product-list.handler
    events:
      - httpApi:
          method: GET
          path: /products
      
  get_product_detail:
    handler: handlers/product-detail.handler
    events:
      - httpApi:
          method: GET
          path: /products/{id}

  data_seeder:
    handler: handlers/data-seeder.handler

plugins:
  - serverless-esbuild
